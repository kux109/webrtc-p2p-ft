<!DOCTYPE html>
<html>
<head>
  <title>Receiver</title>
</head>
<body>
  <h1>Receive File</h1>
  <button id="connectButton">Connect</button>
  <p id="status"></p>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let peerConnection;

    document.getElementById('connectButton').onclick = async () => {
      const offer = await new Promise((resolve) => {
        socket.on('offer', ({ sdp }) => resolve(sdp));
      });

      peerConnection.setRemoteDescription(offer);
      const answer = await peerConnection.createAnswer();
      await peerConnection.setLocalDescription(answer);
      socket.emit('answer', { sdp: answer });
    };

    socket.on('candidate', ({ candidate }) => {
      peerConnection.addIceCandidate(candidate);
    });

    async function setupConnection() {
      peerConnection = new RTCPeerConnection();
      peerConnection.ondatachannel = (event) => {
        const channel = event.channel;
        channel.onmessage = (event) => {
          const file = event.data;
          // Save file or display
          console.log('Received file:', file);
          document.getElementById('status').textContent = 'File received';
        };
      };
    }

    setupConnection();
  </script>
</body>
</html>